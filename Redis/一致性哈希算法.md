## 一致性哈希算法

要将一个键放到分布式缓存中，如何将其路由到指定节点，并且保证扩缩容后路由任然不变？

1. 将节点映射到一个0~2^32的圆环上：hash(节点ID) mod 2^32；
2. 将键映射到同一个环上：hash(key) mod 2^32；
3. 然后从数据映射位置开始顺时针查找，找到的第一个节点就是数据保存的位置。

优点：当某个节点宕机，只有部分缓存失效（映射到下一个节点了）。

缺陷：将节点映射到环上时不一定均匀，可能有大量数据存到其中一个节点，而其他节点存较少的数据。

为解决这个问题，引入了虚拟节点机制，即对每一个服务节点都计算多个哈希，每个计算结果位置都放置一个服务节点，称为虚拟节点。例如对虚拟节点A1，A2，A3分别计算哈希值形成3个虚拟节点，定位到这三个虚拟节点的数据实际上存放在真实节点A中。实际应用中，将虚拟节点数设置为32甚至更大，即使只有很少的节点也能做到相对均匀的数据分布。